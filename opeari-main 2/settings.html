<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opeari Settings - General</title>
    <style>
        :root {
            /* Opeari Brand Colors */
            --mint-primary: #95BBAD;
            --mint-medium: #48735E;
            --mint-pale: #E8F8F0;
            --dark-green: #20694E;
            --peach: #FFCCC7;
            --soft-yellow: #fff7d6;
            --light-green: #D4FFEB;
            
            /* System Colors */
            --white: #ffffff;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            
            /* Status Colors */
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(30, 107, 78, 0.05);
            --shadow: 0 4px 20px rgba(30, 107, 78, 0.08);
            --shadow-lg: 0 8px 30px rgba(30, 107, 78, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comfortaa', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #D4FFEB 0%, #fff7d6 50%, #FFCCC7 100%);
            min-height: 100vh;
            color: var(--dark-green);
            line-height: 1.6;
        }

        /* Header */
        .main-nav {
            background: var(--white);
            border-bottom: 2px solid var(--gray-200);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-sm);
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }
        
        .nav-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            transition: transform 0.3s ease;
        }
        
        .nav-logo:hover {
            transform: scale(1.02);
        }
        
        .nav-logo-img {
            width: 40px;
            height: 40px;
            filter: drop-shadow(0 2px 4px rgba(30, 107, 78, 0.2));
        }
        
        .nav-logo-text {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-green);
            font-family: 'Comfortaa', sans-serif;
        }
        
        .nav-links {
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            color: var(--gray-600);
            text-decoration: none;
            font-weight: 500;
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
            font-family: 'Comfortaa', sans-serif;
        }
        
        .nav-link:hover {
            color: var(--dark-green);
            background: var(--mint-pale);
            transform: translateY(-1px);
        }
        
        .nav-link-active {
            color: var(--dark-green) !important;
            background: var(--mint-pale) !important;
        }

        .nav-user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .nav-user-info {
            text-align: right;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .nav-user-name {
            font-weight: 600;
            color: var(--dark-green);
            font-size: 0.9rem;
        }
        
        .nav-user-points {
            font-size: 0.75rem;
            color: var(--gray-500);
            font-weight: 500;
        }

        /* Container - Mobile First */
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 16px;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 800px;
                padding: 24px;
            }
        }

        /* Tab Navigation */
        .tab-navigation {
            background: var(--white);
            border-radius: 16px;
            padding: 6px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tab-list {
            display: flex;
            gap: 4px;
            min-width: max-content;
        }

        .tab-button {
            padding: 12px 16px;
            border: none;
            background: transparent;
            border-radius: 12px;
            font-family: inherit;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
            min-height: 44px;
            position: relative;
            text-decoration: none;
        }

        .tab-button:hover {
            background: var(--gray-100);
            color: var(--dark-green);
        }

        .tab-button:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--mint-primary);
            background: var(--gray-100);
        }

        .tab-button.active {
            background: linear-gradient(135deg, var(--mint-primary), var(--mint-medium));
            color: var(--white);
            box-shadow: var(--shadow-sm);
        }

        .tab-button.active:focus {
            box-shadow: 0 0 0 2px var(--mint-primary), var(--shadow-sm);
        }

        .tab-icon {
            width: 16px;
            height: 16px;
        }

        /* Quick Actions Bar */
        .quick-actions {
            background: var(--white);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 2px solid var(--mint-pale);
        }

        .quick-actions h3 {
            font-size: 1rem;
            margin-bottom: 12px;
            color: var(--dark-green);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: var(--mint-pale);
            color: var(--dark-green);
            border: 1px solid var(--mint-primary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .action-btn:hover {
            background: var(--mint-primary);
            color: var(--white);
            transform: translateY(-1px);
        }

        /* Role Indicator */
        .role-indicator {
            position: fixed;
            top: 90px;
            right: 20px;
            background: var(--white);
            border: 2px solid var(--mint-primary);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--dark-green);
            box-shadow: var(--shadow);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .role-indicator:hover {
            background: var(--mint-pale);
        }

        /* Settings Content */
        .settings-content {
            background: var(--white);
            border-radius: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        /* Section Headers */
        .section-header {
            background: linear-gradient(135deg, var(--mint-pale), var(--light-green));
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-green);
            margin-bottom: 4px;
        }

        .section-subtitle {
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        .personalized-tip {
            background: var(--soft-yellow);
            border: 1px solid #f0eb9a;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-size: 0.85rem;
            color: var(--dark-green);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Form Sections */
        .form-section {
            padding: 28px;
        }

        .form-section:not(:last-child) {
            border-bottom: 1px solid var(--gray-200);
        }

        .section-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-green);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Setting Cards */
        .settings-grid {
            display: grid;
            gap: 16px;
            margin-top: 20px;
        }

        @media (min-width: 768px) {
            .settings-grid.two-column {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .setting-card {
            background: var(--gray-50);
            border: 2px solid var(--gray-200);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .setting-card:hover, .setting-card:focus-within {
            border-color: var(--mint-primary);
            background: var(--mint-pale);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .setting-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .setting-info {
            flex: 1;
            margin-right: 16px;
        }

        .setting-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark-green);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-description {
            color: var(--gray-600);
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .setting-control {
            flex-shrink: 0;
        }

        /* Toggle Switches */
        .toggle-switch {
            width: 56px;
            height: 28px;
            background: var(--gray-300);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            outline: none;
        }

        .toggle-switch:focus {
            box-shadow: 0 0 0 2px var(--mint-primary);
        }

        .toggle-switch.active {
            background: var(--success);
        }

        .toggle-switch::after {
            content: '';
            width: 24px;
            height: 24px;
            background: var(--white);
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .toggle-switch.active::after {
            transform: translateX(28px);
        }

        /* Form Controls */
        .form-grid {
            display: grid;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .form-grid.two-column {
                grid-template-columns: 1fr 1fr;
            }
        }

        .form-group {
            position: relative;
        }

        .form-label {
            display: block;
            font-weight: 500;
            color: var(--dark-green);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .label-help {
            display: block;
            color: var(--gray-500);
            font-weight: 400;
            font-size: 0.8rem;
            margin-top: 2px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: var(--white);
            color: var(--gray-700);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--mint-primary);
            box-shadow: 0 0 0 4px rgba(149, 187, 173, 0.1);
            transform: translateY(-1px);
        }

        /* Auto-save Indicator */
        .auto-save-indicator {
            position: absolute;
            top: 8px;
            right: 16px;
            background: var(--success);
            color: var(--white);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .auto-save-indicator.show {
            opacity: 1;
        }

        .auto-save-indicator.saving {
            background: var(--warning);
        }

        .auto-save-indicator.error {
            background: var(--error);
        }

        /* Account Stats */
        .account-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .stat-card {
            background: var(--white);
            border: 2px solid var(--mint-pale);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--mint-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark-green);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--gray-600);
            font-weight: 500;
        }

        .stat-icon {
            width: 32px;
            height: 32px;
            margin: 0 auto 12px;
            color: var(--mint-primary);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: var(--white);
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            max-width: 300px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: var(--error);
        }

        .toast.warning {
            background: var(--warning);
        }

        /* Search functionality */
        .search-container {
            position: relative;
            margin-bottom: 16px;
        }

        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-icon {
            position: absolute;
            left: 16px;
            color: var(--gray-400);
            z-index: 2;
        }

        .search-input {
            width: 100%;
            padding: 14px 16px 14px 48px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: var(--white);
            color: var(--gray-700);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--mint-primary);
            box-shadow: 0 0 0 4px rgba(149, 187, 173, 0.1);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border: 2px solid var(--mint-primary);
            border-radius: 12px;
            margin-top: 4px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            display: none;
        }

        .search-result-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid var(--gray-100);
            transition: all 0.3s ease;
        }

        .search-result-item:hover {
            background: var(--mint-pale);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-title {
            font-weight: 600;
            color: var(--dark-green);
            margin-bottom: 2px;
        }

        .search-result-description {
            font-size: 0.85rem;
            color: var(--gray-600);
        }
        @media (max-width: 767px) {
            .container {
                padding: 12px;
            }

            .form-section {
                padding: 20px 16px;
            }

            .role-indicator {
                position: static;
                margin-bottom: 16px;
                margin-left: auto;
                margin-right: auto;
                width: fit-content;
            }

            .toast {
                bottom: 90px;
                right: 16px;
                left: 16px;
                max-width: none;
            }

            .nav-links {
                display: none;
            }

            .tab-navigation {
                margin: 0 -12px 20px -12px;
                border-radius: 0;
            }

            .tab-list {
                padding: 0 12px;
                scroll-behavior: smooth;
            }

            .tab-button {
                min-width: 120px;
                justify-content: center;
            }

            .settings-grid.two-column {
                grid-template-columns: 1fr;
            }

            .form-grid.two-column {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .account-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Footer */
        .site-footer {
            background: linear-gradient(135deg, var(--mint-pale) 0%, var(--light-green) 100%);
            color: var(--dark-green);
            margin-top: 60px;
            font-family: 'Comfortaa', sans-serif;
        }
        
        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .footer-top {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 40px;
            padding: 60px 0 40px 0;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .footer-section h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark-green);
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .footer-logo-img {
            width: 40px;
            height: 40px;
            filter: drop-shadow(0 2px 4px rgba(30, 107, 78, 0.2));
        }
        
        .footer-logo-text {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-green);
        }
        
        .footer-description {
            color: var(--gray-600);
            line-height: 1.6;
            margin-bottom: 25px;
            font-size: 0.95rem;
        }
        
        .footer-links {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .footer-links li {
            margin-bottom: 12px;
        }
        
        .footer-links a {
            color: var(--gray-600);
            text-decoration: none;
            transition: color 0.3s ease;
            font-size: 0.9rem;
        }
        
        .footer-links a:hover {
            color: var(--dark-green);
        }
        
        .footer-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 0;
            flex-wrap: wrap;
            gap: 20px;
            border-top: 1px solid var(--gray-200);
        }
        
        .footer-legal p {
            margin: 0;
            color: var(--gray-500);
            font-size: 0.85rem;
        }

        @media (max-width: 767px) {
            .footer-top {
                grid-template-columns: 1fr;
                gap: 30px;
                padding: 40px 0 30px 0;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header Navigation -->
    <nav class="main-nav">
        <div class="nav-container">
            <a href="/" class="nav-logo">
                <svg class="nav-logo-img" viewBox="0 0 40 40" fill="none">
                    <path d="M20 38C30.4934 38 39 29.4934 39 19C39 8.50659 30.4934 0 20 0C9.50659 0 1 8.50659 1 19C1 29.4934 9.50659 38 20 38Z" fill="#95BBAD"/>
                    <path d="M20 32C26.6274 32 32 26.6274 32 20C32 13.3726 26.6274 8 20 8C13.3726 8 8 13.3726 8 20C8 26.6274 13.3726 32 20 32Z" fill="#48735E"/>
                </svg>
                <span class="nav-logo-text">Opeari</span>
            </a>
            
            <div class="nav-links">
                <a href="/dashboard" class="nav-link">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                    </svg>
                    Dashboard
                </a>
                <a href="/find-care" class="nav-link">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"/>
                    </svg>
                    Find Care
                </a>
                <a href="/my-village" class="nav-link">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                    </svg>
                    My Village
                </a>
                <a href="/account-settings" class="nav-link nav-link-active">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z"/>
                    </svg>
                    Settings
                </a>
            </div>
            
            <div class="nav-user-menu">
                <div class="nav-user-info">
                    <div class="nav-user-name">John D.</div>
                    <div class="nav-user-points">4,200 pts</div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Role Indicator -->
    <div class="role-indicator" id="roleIndicator" onclick="switchUserRole()">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
        <span>Parent Mode</span>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
        <span id="toastMessage">Settings updated!</span>
    </div>

    <div class="container">
        <!-- Tab Navigation -->
        <nav class="tab-navigation">
            <div class="tab-list">
                <a href="/account-settings" class="tab-button">
                    <svg class="tab-icon" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                    </svg>
                    <span>Profile</span>
                </a>
                <a href="/account-settings/family" class="tab-button">
                    <svg class="tab-icon" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                    </svg>
                    <span>Family & Care</span>
                </a>
                <a href="/account-settings/schedule" class="tab-button">
                    <svg class="tab-icon" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    <span>Schedule</span>
                </a>
                <a href="/account-settings/safety" class="tab-button">
                    <svg class="tab-icon" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001z" clip-rule="evenodd"/>
                    </svg>
                    <span>Safety & Village</span>
                </a>
                <button class="tab-button active">
                    <svg class="tab-icon" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947z" clip-rule="evenodd"/>
                    </svg>
                    <span>Settings</span>
                </button>
            </div>
        </nav>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <!-- Settings Search -->
            <div class="search-container">
                <div class="search-input-wrapper">
                    <svg class="search-icon" width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"/>
                    </svg>
                    <input 
                        type="text" 
                        class="search-input" 
                        id="settingsSearch"
                        placeholder="Search settings..." 
                        autocomplete="off">
                </div>
                <div class="search-results" id="searchResults"></div>
            </div>
            
            <h3>
                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/>
                </svg>
                Quick Actions
            </h3>
            <div class="action-buttons">
                <button class="action-btn" onclick="resetToDefaults()">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1z" clip-rule="evenodd"/>
                    </svg>
                    Reset Defaults
                </button>
                <button class="action-btn" onclick="exportSettings()">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                    Export Settings
                </button>
                <button class="action-btn" onclick="importSettings()">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 11-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                    </svg>
                    Import Settings
                </button>
                <button class="action-btn" onclick="showEmergencySettings()">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    Emergency Settings
                </button>
            </div>
        </div>

        <!-- Settings Content -->
        <div class="settings-content">
            <!-- Section Header -->
            <div class="section-header">
                <h1 class="section-title" id="sectionTitle">Account & App Settings</h1>
                <p class="section-subtitle" id="sectionSubtitle">Customize your Opeari experience and manage your account preferences</p>
                <div class="personalized-tip" id="personalizedTip">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                    </svg>
                    <span id="tipMessage">Personalize your settings to get the most out of your Opeari village experience</span>
                </div>
            </div>

            <!-- Account Overview Section -->
            <div class="form-section">
                <div class="section-label">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                    </svg>
                    <span id="accountOverviewSectionTitle">Account Overview</span>
                </div>
                
                <div class="account-stats">
                    <div class="stat-card">
                        <svg class="stat-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <div class="stat-number">Jan 2023</div>
                        <div class="stat-label">Member Since</div>
                    </div>
                    <div class="stat-card">
                        <svg class="stat-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                        </svg>
                        <div class="stat-number">12</div>
                        <div class="stat-label">Village Members</div>
                    </div>
                    <div class="stat-card">
                        <svg class="stat-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        <div class="stat-number">4,200</div>
                        <div class="stat-label">Opeari Points</div>
                    </div>
                    <div class="stat-card">
                        <svg class="stat-icon" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001z" clip-rule="evenodd"/>
                        </svg>
                        <div class="stat-number">92</div>
                        <div class="stat-label">Trust Score</div>
                    </div>
                </div>
            </div>

            <!-- Notification Preferences -->
            <div class="form-section">
                <div class="section-label">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"/>
                    </svg>
                    <span id="notificationSectionTitle">Notification Preferences</span>
                </div>
                
                <div class="settings-grid" id="notificationSettings">
                    <!-- Initial notification settings to ensure content shows -->
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                                    </svg>
                                    Care Request Updates
                                </div>
                                <div class="setting-description">Updates on your care requests</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch active" onclick="toggleNotification(this, 'care_requests')" data-field="care_requests">
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    Care Confirmations
                                </div>
                                <div class="setting-description">Confirmations and cancellations for scheduled care</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch active" onclick="toggleNotification(this, 'care_confirmations')" data-field="care_confirmations">
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"/>
                                    </svg>
                                    Village Invites
                                </div>
                                <div class="setting-description">Invitations to join other families' villages</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch active" onclick="toggleNotification(this, 'village_invites')" data-field="village_invites">
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                    </svg>
                                    Safety Alerts
                                </div>
                                <div class="setting-description">Important safety and security notifications</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch active" onclick="toggleNotification(this, 'safety_alerts')" data-field="safety_alerts">
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                    </svg>
                                    Push Notifications
                                </div>
                                <div class="setting-description">Mobile push notifications for urgent updates</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch active" onclick="toggleNotification(this, 'push_notifications')" data-field="push_notifications">
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z" clip-rule="evenodd"/>
                                    </svg>
                                    SMS Notifications
                                </div>
                                <div class="setting-description">Text messages for time-sensitive updates</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch" onclick="toggleNotification(this, 'sms_notifications')" data-field="sms_notifications">
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- App Preferences -->
            <div class="form-section">
                <div class="section-label">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 5a2 2 0 012-2h10a2 2 0 012 2v8a2 2 0 01-2 2h-2.22l.123.489.804.804A1 1 0 0113 18H7a1 1 0 01-.707-1.707l.804-.804L7.22 15H5a2 2 0 01-2-2V5zm5.771 7H5V5h10v7H8.771z" clip-rule="evenodd"/>
                    </svg>
                    <span id="appPreferencesSectionTitle">App Preferences</span>
                </div>

                <div class="form-grid two-column">
                    <div class="form-group">
                        <label class="form-label">
                            Language
                            <span class="label-help">Choose your preferred language</span>
                        </label>
                        <select class="form-select" id="language" data-field="language">
                            <option value="en" selected>English</option>
                            <option value="es">Español</option>
                            <option value="fr">Français</option>
                            <option value="de">Deutsch</option>
                            <option value="pt">Português</option>
                            <option value="zh">中文</option>
                        </select>
                        <div class="auto-save-indicator" id="language-indicator">Saved</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Time Zone
                            <span class="label-help">Your local time zone for scheduling</span>
                        </label>
                        <select class="form-select" id="timezone" data-field="timezone">
                            <option value="America/Los_Angeles" selected>Pacific Time (PT)</option>
                            <option value="America/Denver">Mountain Time (MT)</option>
                            <option value="America/Chicago">Central Time (CT)</option>
                            <option value="America/New_York">Eastern Time (ET)</option>
                            <option value="UTC">UTC</option>
                        </select>
                        <div class="auto-save-indicator" id="timezone-indicator">Saved</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            App Theme
                            <span class="label-help">Choose your preferred appearance</span>
                        </label>
                        <select class="form-select" id="theme" data-field="theme">
                            <option value="light" selected>Light</option>
                            <option value="dark">Dark</option>
                            <option value="auto">Auto (System)</option>
                        </select>
                        <div class="auto-save-indicator" id="theme-indicator">Saved</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Measurement Units
                            <span class="label-help">Distance and measurement preferences</span>
                        </label>
                        <select class="form-select" id="measurement_units" data-field="measurement_units">
                            <option value="imperial" selected>Imperial (miles, feet)</option>
                            <option value="metric">Metric (km, meters)</option>
                        </select>
                        <div class="auto-save-indicator" id="measurement_units-indicator">Saved</div>
                    </div>
                </div>
            </div>

            <!-- Data & Privacy -->
            <div class="form-section">
                <div class="section-label">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                    </svg>
                    <span id="dataPrivacySectionTitle">Data & Privacy</span>
                </div>

                <div class="settings-grid" id="dataPrivacySettings">
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                                    </svg>
                                    Analytics & Usage Tracking
                                </div>
                                <div class="setting-description">Help improve Opeari by sharing anonymous usage data</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch active" onclick="togglePrivacySetting(this, 'analytics_tracking')" data-field="analytics_tracking">
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                                    </svg>
                                    Location Services
                                </div>
                                <div class="setting-description">Allow location access for distance calculations and local recommendations</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch active" onclick="togglePrivacySetting(this, 'location_tracking')" data-field="location_tracking">
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                    </svg>
                                    Crash Reporting
                                </div>
                                <div class="setting-description">Automatically send crash reports to help fix bugs</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch active" onclick="togglePrivacySetting(this, 'crash_reporting')" data-field="crash_reporting">
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                                    </svg>
                                    Personalized Advertisements
                                </div>
                                <div class="setting-description">Show ads tailored to your interests and activity</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch" onclick="togglePrivacySetting(this, 'personalized_ads')" data-field="personalized_ads">
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                                    </svg>
                                    Third-Party Integrations
                                </div>
                                <div class="setting-description">Allow integration with calendar, payment, and other services</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch active" onclick="togglePrivacySetting(this, 'third_party_integrations')" data-field="third_party_integrations">
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 24px; display: flex; gap: 12px; flex-wrap: wrap;">
                    <button class="action-btn" onclick="downloadData()">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                        Download My Data
                    </button>
                    <button class="action-btn" onclick="viewPrivacyPolicy()">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"/>
                        </svg>
                        Privacy Policy
                    </button>
                </div>
            </div>

            <!-- Emergency & Safety Settings -->
            <div class="form-section" id="emergencySection">
                <div class="section-label">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    <span id="emergencySectionTitle">Emergency & Safety Settings</span>
                </div>

                <div class="settings-grid">
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                    </svg>
                                    Emergency Contacts
                                </div>
                                <div class="setting-description">Manage emergency contact information</div>
                            </div>
                            <div class="setting-control">
                                <button class="action-btn" onclick="manageEmergencyContacts()">Manage</button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                                    </svg>
                                    Location Sharing in Emergencies
                                </div>
                                <div class="setting-description">Share location with emergency contacts during incidents</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch active" onclick="toggleEmergencyLocation(this)" data-field="emergency_location">
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"/>
                                    </svg>
                                    Emergency Alert Sound
                                </div>
                                <div class="setting-description">Play distinct sound for emergency notifications</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch active" onclick="toggleEmergencySound(this)" data-field="emergency_sound">
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Care Preferences -->
            <div class="form-section" id="carePreferencesSection">
                <div class="section-label">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                    <span id="carePreferencesSectionTitle">Care Preferences</span>
                </div>

                <div class="form-grid two-column">
                    <div class="form-group">
                        <label class="form-label">
                            Preferred Care Type
                            <span class="label-help">Your preferred type of childcare arrangement</span>
                        </label>
                        <select class="form-select" id="preferred_care_type" data-field="preferred_care_type">
                            <option value="in_home">In My Home</option>
                            <option value="their_home">In Provider's Home</option>
                            <option value="either" selected>Either Location</option>
                            <option value="public_space">Public Spaces Only</option>
                        </select>
                        <div class="auto-save-indicator" id="preferred_care_type-indicator">Saved</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Maximum Distance
                            <span class="label-help">How far you're willing to travel for care</span>
                        </label>
                        <select class="form-select" id="max_distance" data-field="max_distance">
                            <option value="1">Within 1 mile</option>
                            <option value="2">Within 2 miles</option>
                            <option value="5" selected>Within 5 miles</option>
                            <option value="10">Within 10 miles</option>
                            <option value="unlimited">No limit</option>
                        </select>
                        <div class="auto-save-indicator" id="max_distance-indicator">Saved</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Advance Notice Required
                            <span class="label-help">Minimum notice needed for care requests</span>
                        </label>
                        <select class="form-select" id="advance_notice" data-field="advance_notice">
                            <option value="same_day">Same day</option>
                            <option value="24_hours" selected>24 hours</option>
                            <option value="48_hours">48 hours</option>
                            <option value="1_week">1 week</option>
                        </select>
                        <div class="auto-save-indicator" id="advance_notice-indicator">Saved</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Rate Range
                            <span class="label-help">Your preferred hourly rate range</span>
                        </label>
                        <select class="form-select" id="rate_range" data-field="rate_range">
                            <option value="15-20">$15-20/hour</option>
                            <option value="20-25" selected>$20-25/hour</option>
                            <option value="25-30">$25-30/hour</option>
                            <option value="30-35">$30-35/hour</option>
                            <option value="35+">$35+/hour</option>
                        </select>
                        <div class="auto-save-indicator" id="rate_range-indicator">Saved</div>
                    </div>
                </div>
            </div>

            <!-- Verification & Trust Settings -->
            <div class="form-section" id="verificationSection">
                <div class="section-label">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001z" clip-rule="evenodd"/>
                    </svg>
                    <span id="verificationSectionTitle">Verification & Trust</span>
                </div>

                <div class="settings-grid">
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"/>
                                    </svg>
                                    Background Check
                                </div>
                                <div class="setting-description">Status: Verified ✓</div>
                            </div>
                            <div class="setting-control">
                                <button class="action-btn" onclick="renewBackgroundCheck()">Renew</button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                    </svg>
                                    Reference Checks
                                </div>
                                <div class="setting-description">3 references verified</div>
                            </div>
                            <div class="setting-control">
                                <button class="action-btn" onclick="manageReferences()">Manage</button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    Only Show Verified Providers
                                </div>
                                <div class="setting-description">Only display providers with completed verification</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch active" onclick="toggleVerifiedOnly(this)" data-field="verified_only">
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Security -->
            <div class="form-section">
                <div class="section-label">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001z" clip-rule="evenodd"/>
                    </svg>
                    <span id="securitySectionTitle">Account Security</span>
                </div>

                <div class="settings-grid">
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                                    </svg>
                                    Password
                                </div>
                                <div class="setting-description">Last changed 3 months ago</div>
                            </div>
                            <div class="setting-control">
                                <button class="action-btn" onclick="changePassword()">Change</button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                    </svg>
                                    Email Address
                                </div>
                                <div class="setting-description">john.doe@example.com</div>
                            </div>
                            <div class="setting-control">
                                <button class="action-btn" onclick="changeEmail()">Change</button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M2 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 002 2H4a2 2 0 01-2-2V5zm3 1h6v4H5V6zm6 6H5v2h6v-2z" clip-rule="evenodd"/>
                                        <path d="M15 7h1a2 2 0 012 2v5.5a1.5 1.5 0 01-3 0V9a1 1 0 00-1-1h-1v-1z"/>
                                    </svg>
                                    Two-Factor Authentication
                                </div>
                                <div class="setting-description">Add an extra layer of security</div>
                            </div>
                            <div class="setting-control">
                                <button class="toggle-switch" onclick="toggleTwoFactor(this)" data-field="two_factor_auth">
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-top">
                <div class="footer-section">
                    <div class="footer-logo">
                        <svg class="footer-logo-img" viewBox="0 0 40 40" fill="none">
                            <path d="M20 38C30.4934 38 39 29.4934 39 19C39 8.50659 30.4934 0 20 0C9.50659 0 1 8.50659 1 19C1 29.4934 9.50659 38 20 38Z" fill="currentColor"/>
                        </svg>
                        <span class="footer-logo-text">Opeari</span>
                    </div>
                    <p class="footer-description">
                        Building trusted childcare villages where families support each other. 
                        Safe, verified, and community-focused care for the modern family.
                    </p>
                </div>
                
                <div class="footer-section">
                    <h4>Platform</h4>
                    <ul class="footer-links">
                        <li><a href="/find-care">Find Care</a></li>
                        <li><a href="/offer-care">Offer Care</a></li>
                        <li><a href="/my-village">My Village</a></li>
                        <li><a href="/safety">Safety Center</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul class="footer-links">
                        <li><a href="/help">Help Center</a></li>
                        <li><a href="/contact">Contact Us</a></li>
                        <li><a href="/community">Community</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Company</h4>
                    <ul class="footer-links">
                        <li><a href="/about">About Us</a></li>
                        <li><a href="/careers">Careers</a></li>
                        <li><a href="/press">Press</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="footer-legal">
                    <p>&copy; 2024 Opeari. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // ============================================================================
        // SEARCH FUNCTIONALITY
        // ============================================================================

        function initializeSearch() {
            const searchInput = document.getElementById('settingsSearch');
            const searchResults = document.getElementById('searchResults');

            if (!searchInput) return;

            searchInput.addEventListener('input', function(e) {
                const query = e.target.value.trim();
                
                if (query.length > 0) {
                    performSearch(query);
                } else {
                    searchResults.style.display = 'none';
                }
            });

            // Hide results when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    searchResults.style.display = 'none';
                }
            });
        }

        function performSearch(query) {
            const searchableItems = [
                { title: 'Notifications', description: 'Manage notification preferences', section: 'Notification Preferences' },
                { title: 'Language', description: 'Change app language', section: 'App Preferences' },
                { title: 'Privacy', description: 'Data and privacy settings', section: 'Data & Privacy' },
                { title: 'Security', description: 'Account security settings', section: 'Account Security' },
                { title: 'Two-Factor', description: 'Two-factor authentication', section: 'Account Security' },
                { title: 'Emergency', description: 'Emergency contacts and settings', section: 'Emergency & Safety' },
                { title: 'Care Preferences', description: 'Childcare preferences and requirements', section: 'Care Preferences' },
                { title: 'Background Check', description: 'Verification and background checks', section: 'Verification & Trust' },
                { title: 'Distance', description: 'Maximum travel distance for care', section: 'Care Preferences' },
                { title: 'Rate', description: 'Preferred hourly rate range', section: 'Care Preferences' }
            ];

            const results = searchableItems.filter(item => 
                item.title.toLowerCase().includes(query.toLowerCase()) ||
                item.description.toLowerCase().includes(query.toLowerCase())
            );

            const searchResults = document.getElementById('searchResults');
            
            if (results.length > 0) {
                searchResults.innerHTML = results.map(result => `
                    <div class="search-result-item" onclick="navigateToSetting('${result.title.toLowerCase().replace(/\s+/g, '')}')">
                        <div class="search-result-title">${result.title}</div>
                        <div class="search-result-description">${result.description}</div>
                    </div>
                `).join('');
                searchResults.style.display = 'block';
            } else {
                searchResults.innerHTML = '<div class="search-result-item">No settings found</div>';
                searchResults.style.display = 'block';
            }
        }

        function navigateToSetting(elementId) {
            // Simple scroll to section logic
            const sections = {
                'notifications': 'notificationSettings',
                'language': 'appPreferencesSectionTitle',
                'privacy': 'dataPrivacySettings',
                'security': 'securitySectionTitle',
                'emergency': 'emergencySection',
                'carepreferences': 'carePreferencesSection',
                'backgroundcheck': 'verificationSection',
                'distance': 'max_distance',
                'rate': 'rate_range'
            };
            
            const targetId = sections[elementId] || elementId;
            const element = document.getElementById(targetId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                document.getElementById('searchResults').style.display = 'none';
                document.getElementById('settingsSearch').value = '';
            }
        }

        // ============================================================================
        // EMERGENCY & SAFETY FUNCTIONS
        // ============================================================================

        function showEmergencySettings() {
            const emergencySection = document.getElementById('emergencySection');
            if (emergencySection) {
                emergencySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                showToast('Emergency settings ready for review');
            }
        }

        function manageEmergencyContacts() {
            showToast('Opening emergency contacts manager...');
            // In production: open emergency contacts modal
        }

        function toggleEmergencyLocation(toggleElement) {
            const isActive = toggleElement.classList.contains('active');
            
            if (!isActive) {
                if (confirm('Enable emergency location sharing? This will share your location with emergency contacts during incidents.')) {
                    toggleElement.classList.add('active');
                    showToast('Emergency location sharing enabled');
                    autoSave('emergency_location', true);
                }
            } else {
                if (confirm('Disable emergency location sharing? This may delay emergency response.')) {
                    toggleElement.classList.remove('active');
                    showToast('Emergency location sharing disabled', 'warning');
                    autoSave('emergency_location', false);
                }
            }
        }

        function toggleEmergencySound(toggleElement) {
            const isActive = toggleElement.classList.contains('active');
            
            if (isActive) {
                toggleElement.classList.remove('active');
                showToast('Emergency alert sound disabled');
            } else {
                toggleElement.classList.add('active');
                showToast('Emergency alert sound enabled');
            }
            
            autoSave('emergency_sound', !isActive);
        }

        // ============================================================================
        // VERIFICATION & TRUST FUNCTIONS
        // ============================================================================

        function renewBackgroundCheck() {
            if (confirm('Start background check renewal process? This may take 3-5 business days.')) {
                showToast('Background check renewal initiated');
                // In production: start renewal process
            }
        }

        function manageReferences() {
            showToast('Opening reference management...');
            // In production: open reference management modal
        }

        function toggleVerifiedOnly(toggleElement) {
            const isActive = toggleElement.classList.contains('active');
            
            if (isActive) {
                toggleElement.classList.remove('active');
                showToast('Now showing all providers');
            } else {
                toggleElement.classList.add('active');
                showToast('Now showing verified providers only');
            }
            
            autoSave('verified_only', !isActive);
        }

        // ============================================================================
        // OPEARI GENERAL SETTINGS - SIMPLIFIED & FOCUSED
        // Matching Profile Tab structure and style
        // ============================================================================
        
        // Simple configuration
        const SETTINGS_CONFIG = {
            saveDelay: 1000,
            currentRole: localStorage.getItem('opeari_user_role') || 'parent'
        };

        // Role-based personalization (simplified)
        const personalizationConfig = {
            parent: {
                sectionTitle: 'Family Account Settings',
                sectionSubtitle: 'Manage your family\'s Opeari experience and preferences',
                tipMessage: 'Customize notifications to stay informed about your children\'s care',
                accountOverviewSectionTitle: 'Family Account Overview',
                notificationSectionTitle: 'Family Notifications',
                appPreferencesSectionTitle: 'App Preferences',
                dataPrivacySectionTitle: 'Family Data & Privacy',
                securitySectionTitle: 'Account Security',
                emergencySectionTitle: 'Emergency & Safety Settings',
                carePreferencesSectionTitle: 'Care Preferences',
                verificationSectionTitle: 'Provider Verification Requirements'
            },
            provider: {
                sectionTitle: 'Provider Account Settings',
                sectionSubtitle: 'Manage your childcare provider account and business preferences',
                tipMessage: 'Keep notifications enabled to respond quickly to care requests',
                accountOverviewSectionTitle: 'Provider Account Overview',
                notificationSectionTitle: 'Business Notifications',
                appPreferencesSectionTitle: 'App Preferences',
                dataPrivacySectionTitle: 'Business Data & Privacy',
                securitySectionTitle: 'Account Security',
                emergencySectionTitle: 'Emergency & Safety Protocols',
                carePreferencesSectionTitle: 'Service Preferences',
                verificationSectionTitle: 'My Verification & Trust'
            },
            both: {
                sectionTitle: 'Community Account Settings',
                sectionSubtitle: 'Manage settings for both requesting and providing childcare',
                tipMessage: 'Balance notifications to stay connected without being overwhelmed',
                accountOverviewSectionTitle: 'Community Account Overview',
                notificationSectionTitle: 'Community Notifications',
                appPreferencesSectionTitle: 'App Preferences',
                dataPrivacySectionTitle: 'Community Data & Privacy',
                securitySectionTitle: 'Account Security',
                emergencySectionTitle: 'Emergency & Safety Settings',
                carePreferencesSectionTitle: 'Care Preferences',
                verificationSectionTitle: 'Verification & Trust'
            }
        };

        // Simple state management
        let currentSettings = {
            notifications: {
                care_requests: true,
                care_confirmations: true,
                village_invites: true,
                safety_alerts: true,
                push_notifications: true,
                sms_notifications: false
            },
            preferences: {
                language: 'en',
                timezone: 'America/Los_Angeles',
                theme: 'light',
                measurement_units: 'imperial'
            },
            privacy: {
                analytics_tracking: true,
                location_tracking: true,
                crash_reporting: true,
                personalized_ads: false,
                third_party_integrations: true
            },
            emergency: {
                emergency_location: true,
                emergency_sound: true
            },
            verification: {
                verified_only: true
            }
        };

        let saveTimeout;

        // ============================================================================
        // NOTIFICATION SETTINGS
        // ============================================================================

        function renderNotificationSettings() {
            const container = document.getElementById('notificationSettings');
            if (!container) return;
            
            const role = SETTINGS_CONFIG.currentRole;
            const settings = currentSettings.notifications;
            
            const notificationTypes = {
                care_requests: {
                    title: role === 'parent' ? 'Care Request Updates' : 'New Care Requests',
                    description: role === 'parent' ? 'Updates on your care requests' : 'Notifications for new care opportunities',
                    icon: '<svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/></svg>'
                },
                care_confirmations: {
                    title: 'Care Confirmations',
                    description: 'Confirmations and cancellations for scheduled care',
                    icon: '<svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>'
                },
                village_invites: {
                    title: 'Village Invites',
                    description: 'Invitations to join other families\' villages',
                    icon: '<svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"/></svg>'
                },
                safety_alerts: {
                    title: 'Safety Alerts',
                    description: 'Important safety and security notifications',
                    icon: '<svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>'
                },
                push_notifications: {
                    title: 'Push Notifications',
                    description: 'Mobile push notifications for urgent updates',
                    icon: '<svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/></svg>'
                },
                sms_notifications: {
                    title: 'SMS Notifications',
                    description: 'Text messages for time-sensitive updates',
                    icon: '<svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z" clip-rule="evenodd"/></svg>'
                }
            };
            
            const settingsHTML = Object.entries(notificationTypes).map(([key, config]) => {
                const isEnabled = settings[key] || false;
                
                return `
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    ${config.icon}
                                    ${config.title}
                                </div>
                                <div class="setting-description">${config.description}</div>
                            </div>
                            <div class="setting-control">
                                <button 
                                    class="toggle-switch ${isEnabled ? 'active' : ''}" 
                                    onclick="toggleNotification(this, '${key}')" 
                                    data-field="${key}">
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = settingsHTML;
        }

        function toggleNotification(toggleElement, settingId) {
            const isActive = toggleElement.classList.contains('active');
            
            // Update UI
            if (isActive) {
                toggleElement.classList.remove('active');
            } else {
                toggleElement.classList.add('active');
            }
            
            // Update state
            currentSettings.notifications[settingId] = !isActive;
            
            // Show feedback
            const action = !isActive ? 'enabled' : 'disabled';
            showToast(`Notifications ${action}`);
            
            // Auto-save
            autoSave(settingId, !isActive);
        }

        // ============================================================================
        // DATA PRIVACY SETTINGS
        // ============================================================================

        function renderDataPrivacySettings() {
            const container = document.getElementById('dataPrivacySettings');
            if (!container) return;
            
            const settings = currentSettings.privacy;
            
            const privacyTypes = {
                analytics_tracking: {
                    title: 'Analytics & Usage Tracking',
                    description: 'Help improve Opeari by sharing anonymous usage data',
                    icon: '<svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/></svg>'
                },
                location_tracking: {
                    title: 'Location Services',
                    description: 'Allow location access for distance calculations and local recommendations',
                    icon: '<svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/></svg>'
                },
                crash_reporting: {
                    title: 'Crash Reporting',
                    description: 'Automatically send crash reports to help fix bugs',
                    icon: '<svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>'
                },
                personalized_ads: {
                    title: 'Personalized Advertisements',
                    description: 'Show ads tailored to your interests and activity',
                    icon: '<svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/></svg>'
                },
                third_party_integrations: {
                    title: 'Third-Party Integrations',
                    description: 'Allow integration with calendar, payment, and other services',
                    icon: '<svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/></svg>'
                }
            };
            
            const settingsHTML = Object.entries(privacyTypes).map(([key, config]) => {
                const isEnabled = settings[key] || false;
                
                return `
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-info">
                                <div class="setting-title">
                                    ${config.icon}
                                    ${config.title}
                                </div>
                                <div class="setting-description">${config.description}</div>
                            </div>
                            <div class="setting-control">
                                <button 
                                    class="toggle-switch ${isEnabled ? 'active' : ''}" 
                                    onclick="togglePrivacySetting(this, '${key}')" 
                                    data-field="${key}">
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = settingsHTML;
        }

        function togglePrivacySetting(toggleElement, settingId) {
            const isActive = toggleElement.classList.contains('active');
            
            // Update UI
            if (isActive) {
                toggleElement.classList.remove('active');
            } else {
                toggleElement.classList.add('active');
            }
            
            // Update state
            currentSettings.privacy[settingId] = !isActive;
            
            // Show feedback
            const action = !isActive ? 'enabled' : 'disabled';
            showToast(`Privacy setting ${action}`);
            
            // Auto-save
            autoSave(settingId, !isActive);
        }

        // ============================================================================
        // APP PREFERENCES
        // ============================================================================

        function loadAppPreferences() {
            const preferences = currentSettings.preferences;
            
            // Populate form fields
            Object.entries(preferences).forEach(([key, value]) => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = value;
                }
            });
        }

        // ============================================================================
        // ROLE MANAGEMENT & PERSONALIZATION
        // ============================================================================

        function switchUserRole() {
            const roles = ['parent', 'provider', 'both'];
            const currentIndex = roles.indexOf(SETTINGS_CONFIG.currentRole);
            const nextIndex = (currentIndex + 1) % roles.length;
            SETTINGS_CONFIG.currentRole = roles[nextIndex];
            
            localStorage.setItem('opeari_user_role', SETTINGS_CONFIG.currentRole);
            
            initializePersonalization();
            showToast(`Switched to ${SETTINGS_CONFIG.currentRole} mode!`);
        }

        function initializePersonalization() {
            const config = personalizationConfig[SETTINGS_CONFIG.currentRole];
            
            updateElementContent('sectionTitle', config.sectionTitle);
            updateElementContent('sectionSubtitle', config.sectionSubtitle);
            updateElementContent('tipMessage', config.tipMessage);
            updateElementContent('accountOverviewSectionTitle', config.accountOverviewSectionTitle);
            updateElementContent('notificationSectionTitle', config.notificationSectionTitle);
            updateElementContent('appPreferencesSectionTitle', config.appPreferencesSectionTitle);
            updateElementContent('dataPrivacySectionTitle', config.dataPrivacySectionTitle);
            updateElementContent('securitySectionTitle', config.securitySectionTitle);
            updateElementContent('emergencySectionTitle', config.emergencySectionTitle);
            updateElementContent('carePreferencesSectionTitle', config.carePreferencesSectionTitle);
            updateElementContent('verificationSectionTitle', config.verificationSectionTitle);
            
            updateRoleIndicator();
        }

        function updateRoleIndicator() {
            const roleIndicator = document.getElementById('roleIndicator');
            const currentRole = SETTINGS_CONFIG.currentRole;
            
            const roleNames = {
                'parent': 'Parent Mode',
                'provider': 'Provider Mode', 
                'both': 'Parent + Provider Mode'
            };
            
            const roleIcons = {
                'parent': '<path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>',
                'provider': '<path fill-rule="evenodd" d="M6 6V5a3 3 0 013-3h2a3 3 0 013 3v1h2a2 2 0 012 2v3.57A22.952 22.952 0 0110 13a22.95 22.95 0 01-8-1.43V8a2 2 0 012-2h2zm2-1a1 1 0 011-1h2a1 1 0 011 1v1H8V5zm1 5a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd"/>',
                'both': '<path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>'
            };
            
            if (roleIndicator) {
                roleIndicator.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        ${roleIcons[currentRole]}
                    </svg>
                    <span>${roleNames[currentRole]}</span>
                `;
            }
        }

        // ============================================================================
        // QUICK ACTIONS
        // ============================================================================

        function resetToDefaults() {
            if (confirm('Reset all settings to defaults? This action cannot be undone.')) {
                currentSettings = {
                    notifications: {
                        care_requests: true,
                        care_confirmations: true,
                        village_invites: true,
                        safety_alerts: true,
                        push_notifications: true,
                        sms_notifications: true
                    },
                    preferences: {
                        language: 'en',
                        timezone: 'America/Los_Angeles',
                        theme: 'light',
                        measurement_units: 'imperial'
                    },
                    privacy: {
                        analytics_tracking: true,
                        location_tracking: true,
                        crash_reporting: true,
                        personalized_ads: false,
                        third_party_integrations: true
                    }
                };
                
                loadSettingsData();
                showToast('Settings reset to defaults');
            }
        }

        function exportSettings() {
            const settings = {
                ...currentSettings,
                exportDate: new Date().toISOString(),
                role: SETTINGS_CONFIG.currentRole
            };
            
            const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `opeari-settings-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('Settings exported successfully');
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const settings = JSON.parse(e.target.result);
                            
                            if (confirm('Import these settings? Current settings will be overwritten.')) {
                                if (settings.notifications) {
                                    currentSettings.notifications = settings.notifications;
                                }
                                if (settings.preferences) {
                                    currentSettings.preferences = settings.preferences;
                                }
                                if (settings.privacy) {
                                    currentSettings.privacy = settings.privacy;
                                }
                                
                                loadSettingsData();
                                showToast('Settings imported successfully');
                            }
                        } catch (error) {
                            showToast('Invalid settings file', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // ============================================================================
        // ACCOUNT ACTIONS
        // ============================================================================

        function changePassword() {
            showToast('Opening password change form...');
        }

        function changeEmail() {
            showToast('Opening email change form...');
        }

        function toggleTwoFactor(toggleElement) {
            const isActive = toggleElement.classList.contains('active');
            
            if (!isActive) {
                if (confirm('Enable two-factor authentication? This will add an extra security step to sign in.')) {
                    toggleElement.classList.add('active');
                    showToast('Two-factor authentication enabled');
                    autoSave('two_factor_auth', true);
                }
            } else {
                if (confirm('Disable two-factor authentication? This will reduce your account security.')) {
                    toggleElement.classList.remove('active');
                    showToast('Two-factor authentication disabled', 'warning');
                    autoSave('two_factor_auth', false);
                }
            }
        }

        function downloadData() {
            showToast('Data download link sent to your email');
        }

        function viewPrivacyPolicy() {
            window.open('/privacy-policy', '_blank');
        }

        // ============================================================================
        // AUTO-SAVE SYSTEM
        // ============================================================================

        function autoSave(fieldId, value) {
            const indicator = document.getElementById(`${fieldId}-indicator`);
            
            // Show saving state
            if (indicator) {
                indicator.textContent = 'Saving...';
                indicator.className = 'auto-save-indicator show saving';
            }
            
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                try {
                    // Simulate save
                    console.log(`💾 Saving ${fieldId}:`, value);
                    
                    // Show success
                    if (indicator) {
                        indicator.textContent = 'Saved';
                        indicator.className = 'auto-save-indicator show';
                        
                        setTimeout(() => {
                            indicator.className = 'auto-save-indicator';
                        }, 2000);
                    }
                    
                } catch (error) {
                    console.error('Auto-save error:', error);
                    
                    // Show error state
                    if (indicator) {
                        indicator.textContent = 'Error';
                        indicator.className = 'auto-save-indicator show error';
                        
                        setTimeout(() => {
                            indicator.className = 'auto-save-indicator';
                        }, 3000);
                    }
                }
            }, SETTINGS_CONFIG.saveDelay);
        }

        // ============================================================================
        // UTILITY FUNCTIONS
        // ============================================================================

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const messageElement = document.getElementById('toastMessage');
            
            messageElement.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        function updateElementContent(elementId, content) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = content;
            }
        }

        function loadSettingsData() {
            renderNotificationSettings();
            renderDataPrivacySettings();
            loadAppPreferences();
            
            // Initialize all toggle states
            initializeToggleStates();
        }

        function initializeToggleStates() {
            // Set initial states for emergency toggles
            const emergencyLocationToggle = document.querySelector('[data-field="emergency_location"]');
            const emergencySoundToggle = document.querySelector('[data-field="emergency_sound"]');
            const verifiedOnlyToggle = document.querySelector('[data-field="verified_only"]');
            
            if (emergencyLocationToggle) emergencyLocationToggle.classList.add('active');
            if (emergencySoundToggle) emergencySoundToggle.classList.add('active'); 
            if (verifiedOnlyToggle) verifiedOnlyToggle.classList.add('active');
        }

        // Setup event listeners
        function setupEventListeners() {
            // Auto-save on input
            document.addEventListener('input', function(e) {
                if (e.target.dataset.field) {
                    const value = e.target.type === 'checkbox' ? e.target.checked : e.target.value;
                    autoSave(e.target.dataset.field, value);
                }
            });

            // Auto-save on select change
            document.addEventListener('change', function(e) {
                if (e.target.dataset.field) {
                    const value = e.target.type === 'checkbox' ? e.target.checked : e.target.value;
                    autoSave(e.target.dataset.field, value);
                }
            });
        }

        // ============================================================================
        // INITIALIZATION
        // ============================================================================

        document.addEventListener('DOMContentLoaded', function() {
            console.log('🍐 Opeari General Settings Loaded!');
            
            initializePersonalization();
            initializeSearch();
            loadSettingsData();
            setupEventListeners();
            
            setTimeout(() => {
                showToast('Settings loaded successfully!');
            }, 1000);
        });
    </script>
</body>
</html>
